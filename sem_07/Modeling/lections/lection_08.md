# Продолжение предыдущей темы

В i-м приборе обслуживания имеем два потока:

1) Поток заявок – интервал времени между моментами появления заявки на входе канала $k_i$
2) Поток обслуживания – интервал времени между началом и концом обсаживания заявки в канале.

Заявки, обслуженные каналом, и заявки, покинувшие i-й прибор необслуженными, образуют выходной поток $y_i$. Процесс функционирования i-го прибора можно представить как *процесс изменения его состояния во времени*. Переход в новое состояние означает изменение количества заявок. Они могут находиться как в накопителе, так и в канале. Следовательно, вектор состояния для i-го прибора имеет следующий вид: $\overrightarrow{Z_i}=(Z_k^n, Z_i^k)$ 

Состояние накопителя: 

- если 0, то, накопитель пуст;
- если $Z_i$ равно емкости накопителя, то накопитель полностью занят. 

Состояние канала:

- если 0, то канал свободен;
- если 1, то канал занят. 

В практике моделирования сложных систем элементарные и сложные приборы обычно объединяются, при этом, если каналы различных приборов обслуживания соединены параллельно, то имеет место многоканальное обслуживание, то если последовательное – то многофазное обслуживание. Поэтому для задания схемы необходимо использовать оператор сопряжения, отражающий взаимосвязь элементов между собой. Различают разомкнутые, замкнутые и смешанного типа.

Собственными внутренними параметрами Q-схемы будут являться:

- количество фаз
- количество каналов в каждой фазе
- количество накопителей в каждой фазе
- емкость i-ого накопителя

Для задания Q-схемы также необходимо описание алгоритма функционирования Q-схемы, который в данной интерпретации определяет поведение заявок в системе в различных ситуациях – неоднородность заявок. Следовательно, Q-схема, описывающая процесс функционирования системы массового обслуживания, может быть записана в виде кортежа:

$Q = (W, U, R, H, Z, A)$, где 

1. **W** - подмножество входных потоков.
2. **U** - подмножество потоков обслуживания.
3. **H** - подмножество собственных параметров. 
4. **Z** - множество состояний элементов системы.
5. **R** - оператор сопряжения элементов структуры (вектор сопряжения).
6. **A** - оператор алгоритмов обслуживания заявок.

> Самостоятельно изучить блочно-иерархический моделирования Q-схем



Для получения соотношений, связывающих характеристики описывающих функционирование Q-схем, вводят некоторые допущения относительно входных потоков, функций распределения, длительности обслуживания запросов, дисциплин обслуживания. Для математического описания функционирования устройств развивающихся в форме случайного процесса,  может быть с успехом применен математический аппарат в теории вероятности для, так называемых, марковских случайных процессов. 

Случайный процесс, протекающий в некоторой системе S, называется **марковским**, если он обладает следующим свойством: для каждого момента времени вероятность любого состояния системы в будущем зависит только от ее состояния в настоящем и не зависит от того, когда и каким образом система пришла в это состояние.

> Марковских систем в реальности нет

Для марковского процесса обычно составляются уравнения Колмагорова:

$F = (p'(t),p(t),\Lambda) = 0$, где

- $\Lambda$ – некоторый набор коэффициентов,
- $p$ – вероятность,
- $p'$ – производная вероятности.

$p = (p(t), \Lambda) = 0$

$p=p(\Lambda)$

$Y=Y(p(\Delta))$

$Y = Y(X, V, L)$

Следовательно нам нужно осуществить связь внутренних параметров модели: $\Lambda$ с конструктивными параметрами $X$, неуправляемыми параметрами $V$, учитывая по внутренним параметрам $H$. Таким образом:

$\Lambda = \Lambda(X, V, L)$

То есть получаем интерфейсную модель. Следовательно, математическая модель системы строится как совокупность базисной модели и интерфейсной, что позволяет использовать одни и те же базисные модели для решения разных задач по моделированию, осуществляя настройку на соответствующую задачу посредством изменения интерфейсной модели.

Определения вероятностей состояния. Пусть наша система S имеет 4 различимых состояния.

```mermaid
graph TB;
node1((S1)); node2((S2)); node3((S3)); node4((S4));

node1 --> node2;
node1 --> node3;
node2 --> node4;
node4 --> node2;
node3 --> node4;

classDef default fill:none, color:white, stroke:white;
linkStyle default fill:none, stroke:white;
```

где имя стрелки $Sx$ – $Sy$ == $\Lambda_{xy}$ (отсутствует стрелка $S_2$ – $S_3$).

Найдем вероятность p1, то есть вероятность того, что система будет находится в состоянии S1.

Это можно найти двумя способами:

- в момент $t$ система была уже в состоянии S1;
- в момент времени $t$ уже была в состоянии S3 и за $\Delta t$ пришла в состояние S1.

Вероятность первого способа как произведение вероятностей $P1(t)$ на  условную вероятность того, что будучи в состоянии S1 система не перейдет в состояние S2.

Таким образом мы получаем первое уравнение Колмогорова:

$P_1(t+\Delta t) = P_1(t)(1-\lambda_{12}\Delta t)+P_3(t)\Lambda_{31}\Delta t$

$\lim\limits_{\Delta t\to 0}{\frac{P_1(t+\Delta t)-P_1(t)}{\Delta t} = -P_1(t)\lambda_{12}+P_3(t)\lambda}$

$P'_1(t) = -P_1(t)\lambda_{12}+P_3(t)\lambda$

Все уравнения Колмогорова:

$$
\begin{cases}
P'_1(t) = -P_1(t)\lambda_{12} + P_3(t)\lambda \\
P'_2(t) = -P_2(t)\lambda_{24} - P_2(t)\lambda_{23} + P_1(t)\lambda_{12} + P_4(t)\lambda_{42} \\
P'_3(t) = -P_3(t)\lambda_{31} - P_3(t)\lambda_{34} + P_2(t)\lambda_{23} \\
P'_4(t) = -P_4(t)\lambda_{42} - P_2(t)\lambda_{24} + P_3(t)\lambda_{34}
\end{cases}
$$

Интегрирование данной системы дает искомые. Начальное условие берется в зависимости от того, каково было изначальное состояние системы. Обязательно нужно добавить условие нормировки.

Уравнения Колмогорова строятся по следующим правилам.

1. В левой части каждого уравнения стоит производная вероятности  состояния, а в правой части содержится столько членов, сколько стрелок  связано с этим состоянием.
2. Если стрелка направлена из состояния, соответствующий член имеет знак "–", если в состояние, то знак "+".
3. Каждый член равен произведению плотности вероятности перехода (интенсивность), соответствующий данной стрелке, и вероятности того состояния, из которого выходит стрелка.



## Лабораторная работа 2

Необходимо определить **время** пребывания системы в каждом состоянии в установившемся режиме работы системы массового обслуживания. Интуитивно-понятное меню:

- задается количество состояний системы (max-10). Например, 5 – появляется матрица размером  5x5, на пересечении – интенсивности переходов состояний;
- дальше кнопка – "Пуск", появляются две строки (вероятность пребывания и время).

> Срок – выходные включительно