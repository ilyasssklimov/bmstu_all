name: backend

on:
  push:
    branches: [ sem_07 ]
  pull_request:
    branches: [ sem_07 ]

  workflow_dispatch:

jobs:
  testing:
    runs-on: ubuntu-latest

    steps:
      - name: Checking-out repository
        uses: actions/checkout@v2
      
      - name: Install dependecies
        run: |
          sudo apt-get -y update
          sudo apt-get -y install libgtest-dev
          sudo apt-get -y install libgmock-dev
      
      - name: Build tests
        working-directory: sem_07/WEB/labs/back
        run: |
          mkdir build
          cd build
          cmake .. -DWITH_TESTS=1
          make
          
      - name: Unit testing
        working-directory: sem_07/WEB/labs/back/build
        run: |
          echo "Testing business logic..."
          ./lib/business_logic/tests/test_business
          echo "Testing data access layer..."
          ./lib/data_access_layer/tests/test_data
